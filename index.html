<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>frame.899 — media & light systems</title>
<meta name="description" content="frame.899 — poetic multimedia installations & light systems." />
<meta property="og:title" content="frame.899 — media & light systems" />
<meta property="og:description" content="Projects: My Cyprus Walk, Cyprus Flora Series. Collabs: Trace × Kolla, Trinitron Connect." />
<meta property="og:type" content="website" />
<meta name="theme-color" content="#0b0b0b" />
<style>
  :root{
    --bg:#0b0b0b; --fg:#e9e9e9; --muted:#a6a6a6; --rule:#1a1a1a; --acc:#eaeaea;
    --glass-bg: rgba(10,10,12,.22); --glass-brd: rgba(255,255,255,.07);
    --max:1120px; --gap:20px;
    --icon:40px; --icon-m:36px;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--fg);font-family:Inter,system-ui,Helvetica,Arial,sans-serif;line-height:1.6;-webkit-font-smoothing:antialiased}
  a{color:var(--fg);text-decoration:none;border-bottom:1px solid transparent;transition:border-color .2s}
  a:hover{border-color:var(--fg)}
  .wrap{max-width:var(--max);margin:0 auto;padding:32px 20px}
  header,footer{display:flex;align-items:center;justify-content:space-between;gap:16px}
  .logo{font-weight:700;letter-spacing:.3px}
  .logo b{font-weight:800}
  nav a{color:var(--muted);margin-left:16px}
  nav a:hover{color:var(--fg);border-color:transparent}
  .lang{display:flex;gap:10px;align-items:center}
  .lang button{background:transparent;border:1px solid var(--glass-brd);color:var(--fg);padding:4px 8px;border-radius:8px;cursor:pointer}
  .lang .is-active{background:var(--glass-bg);backdrop-filter:blur(10px) saturate(160%);}

  .kicker{font-size:12px;color:var(--muted);letter-spacing:.12em;text-transform:uppercase}
  h1{font-size:36px;line-height:1.2;margin:.25rem 0 0 0}
  .lead{color:var(--muted);max-width:820px;margin:8px 0 24px}

  /* HERO */
  .hero{margin-top:18px}
  .slider{position:relative;border:1px solid var(--rule);border-radius:16px;overflow:hidden;background:#0f0f10}
  .slides{display:flex;overflow:hidden;touch-action:pan-y}
  .slide{min-width:100%;height:62vw;max-height:560px;position:relative;display:flex;align-items:flex-end;justify-content:flex-start;background:#0d0d0f}
  .slide .meta{
    position:absolute;left:20px;bottom:20px;padding:10px 12px;border-radius:12px;
    background:var(--glass-bg);backdrop-filter:blur(12px) saturate(160%);border:1px solid var(--glass-brd)
  }
  .slide h3{margin:0;font-size:18px}
  .slide p{margin:4px 0 0 0;color:#d0d0d0;font-size:14px}
  .slide img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}

  .hnav{position:absolute;inset:0;display:flex;align-items:center;justify-content:space-between;pointer-events:none}
  .iconbtn{
    pointer-events:auto;background:rgba(0,0,0,.45);border:1px solid rgba(255,255,255,.22);
    width:var(--icon);height:var(--icon);border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center
  }
  .iconbtn:hover{background:rgba(0,0,0,.6)}
  .icon{width:24px;height:24px;stroke:#eee;fill:none;stroke-width:1.75;stroke-linecap:round;stroke-linejoin:round}
  .dots{display:flex;gap:8px;justify-content:center;margin:12px 0 0 0}
  .dots button{width:8px;height:8px;border-radius:50%;border:0;background:#3a3a3a;cursor:pointer}
  .dots button.active{background:#e5e5e5}

  /* Sections / grids */
  section{padding:28px 0;border-top:1px solid var(--rule)}
  h2{font-size:18px;letter-spacing:.08em;text-transform:uppercase;margin:0 0 18px 0;color:var(--acc)}
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:var(--gap)}
  .card{
    border:1px solid var(--glass-brd);border-radius:14px;overflow:hidden;cursor:pointer;
    background:var(--glass-bg);backdrop-filter:blur(8px) saturate(140%);box-shadow:0 2px 16px rgba(0,0,0,.18)
  }
  .thumb{aspect-ratio:16/10;background:#111;position:relative}
  .thumb img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover}
  .meta2{padding:12px}
  .tag{display:inline-block;font-size:12px;color:var(--muted);border:1px solid var(--rule);padding:2px 8px;border-radius:999px;margin-right:6px}

  /* Modal (bigger + glass) */
  #overlay{
    position:fixed; inset:0; background:rgba(8,8,10,.55);
    display:none; z-index:50; pointer-events:none; /* прокручиваем фон */
    backdrop-filter: blur(10px) saturate(140%);
  }
  #overlay.show{ display:block; }
  #overlay .modal{
    position:relative; width:90vw; max-width:1400px; height:90vh; margin:5vh auto;
    background:var(--glass-bg); backdrop-filter:blur(14px) saturate(160%);
    border:1px solid var(--glass-brd); border-radius:18px; overflow:hidden;
    display:grid; grid-template-columns:1.4fr 1fr; grid-template-rows:1fr auto auto; gap:0;
    pointer-events:auto; /* клики ловим только на самой модалке */
  }
  @media (max-width:980px){
    #overlay .modal{ grid-template-columns:1fr; grid-template-rows:1fr auto auto auto; width:100vw; height:100vh; margin:0; border-radius:0 }
  }
  .m-close{
    position:absolute; top:10px; right:12px;
    background:rgba(0,0,0,.45); border:1px solid rgba(255,255,255,.22);
    width:var(--icon); height:var(--icon); border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center; z-index:6;
  }

  .m-media{ position:relative; background:#0a0a0a; }
  .viewport{
    position:relative; width:100%; height:100%;
    display:flex; align-items:center; justify-content:center; background:#0a0a0a;
    padding:56px 0 84px; /* карманы под ⛶ и точки */
  }
  .viewport img, .viewport video{
    max-width:100%; max-height:100%;
    width:auto; height:auto; object-fit:contain; display:block; background:#000;
  }
  .mnav{ position:absolute; top:50%; left:0; right:0; transform:translateY(-50%); display:flex; justify-content:space-between; padding:0 10px; z-index:5 }
  .fs-btn{
    position:absolute; bottom:10px; right:12px; z-index:6;
    background:rgba(0,0,0,.45); border:1px solid rgba(255,255,255,.22);
    width:var(--icon); height:var(--icon); border-radius:50%; cursor:pointer; display:flex; align-items:center; justify-content:center;
  }

  .m-meta{ padding:20px; border-left:1px solid var(--glass-brd); overflow:auto }
  .m-meta h3{ margin:0 0 6px }
  .m-sub{ margin:0 0 12px; color:#bcbcbc; font-size:14px }
  .m-desc, .m-stmt{ color:#ddd; font-size:15px; line-height:1.6 }
  .m-stmt{ margin-top:10px; border-top:1px solid var(--glass-brd); padding-top:10px }

  .m-thumbs{
    border-top:1px solid var(--glass-brd);
    padding:10px 12px; display:flex; gap:10px; overflow:auto; background:#0b0b0b;
  }
  .m-thumbs button{
    border:1px solid var(--glass-brd); background:#0f0f0f; padding:0; cursor:pointer;
    width:90px; height:60px; border-radius:8px; overflow:hidden; position:relative; flex:0 0 auto;
  }
  .m-thumbs img{ width:100%; height:100%; object-fit:cover; display:block; }
  .m-thumbs .is-active{ outline:2px solid #e6e6e6; }
  .m-thumbs .vid::after{
    content:"▶"; position:absolute; right:6px; bottom:2px; font-size:14px;
    color:#fff; background:rgba(0,0,0,.45); padding:2px 6px; border-radius:6px;
  }

  .m-dots{ padding:10px; display:flex; justify-content:center; gap:8px; }
  .m-dots button{ width:8px; height:8px; border-radius:50%; border:0; background:#3a3a3a; cursor:pointer }
  .m-dots .active{ background:#e5e5e5 }

  @media (max-width:900px){
    h1{font-size:28px}
    .grid,.about{grid-template-columns:1fr}
    .slide{max-height:66vh}
    .iconbtn, .fs-btn, .m-close{ width:var(--icon-m); height:var(--icon-m); }
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">frame<b>899</b></div>
      <nav>
        <a href="#projects" data-i18n="nav.projects">Projects</a>
        <a href="#collabs" data-i18n="nav.collabs">Collabs</a>
        <a href="#about" data-i18n="nav.about">About</a>
        <a href="#contacts" data-i18n="nav.contacts">Contacts</a>
      </nav>
      <div class="lang">
        <button id="enBtn" class="is-active">EN</button>
        <button id="ruBtn">RU</button>
      </div>
    </header>

    <main>
      <div class="hero">
        <div class="kicker" data-i18n="kicker">media & light systems</div>
        <h1 data-i18n="h1">Projects at the edge of art, tech and light</h1>
        <p class="lead" data-i18n="lead">Visual first; details and team below. Built for pitching, submissions and exhibitions.</p>

        <div class="slider" id="slider">
          <div class="slides" id="slides"></div>
          <div class="hnav">
            <button id="hPrev" class="iconbtn" aria-label="Previous">
              <svg class="icon" viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
            </button>
            <button id="hNext" class="iconbtn" aria-label="Next">
              <svg class="icon" viewBox="0 0 24 24"><path d="M9 6l6 6-6 6"/></svg>
            </button>
          </div>
          <div class="dots" id="hdots" aria-label="hero pagination"></div>
        </div>
      </div>

      <section id="projects">
        <h2 data-i18n="projects.title">Projects</h2>
        <div class="grid" id="grid-projects"></div>
      </section>

      <section id="collabs">
        <h2 data-i18n="collabs.title">Collabs</h2>
        <div class="grid" id="grid-collabs"></div>
      </section>

      <section id="about">
        <h2 data-i18n="about.title">About</h2>
        <div class="about">
          <div>
            <h3>Kristina Kubrina</h3>
            <p class="muted" data-i18n="about.kristina">
              Production director & media artist (Cyprus). Experience: FIFA World Cup (Closing), AFC Asian Cup (Opening), The Weeknd tour, Robert Wun, Phillip Lim, Milan Design Week.
              Blends artistic vision with production rigor: visual systems, site adaptation, show planning.
            </p>
          </div>
          <div>
            <h3>Ivan Maksimov</h3>
            <p class="muted" data-i18n="about.ivan">
              CG artist & architect. Spatial visualization, scene readability, integration of media in architecture. Focus on interactivity and light installations.
            </p>
          </div>
        </div>
        <p class="muted" style="margin-top:10px" data-i18n="about.note">
          Some listed large-scale works were done as part of previous teams; media not published due to IP rights.
        </p>
      </section>

      <section id="contacts">
        <h2 data-i18n="contacts.title">Contacts</h2>
        <div class="grid">
          <div>
            <p class="muted" style="margin:0 0 6px" data-i18n="contacts.loc">Base: Cyprus, Limassol</p>
            <p style="margin:0 0 6px">Email: <a href="mailto:hello@frame899.com">hello@frame899.com</a></p>
            <p style="margin:0 0 6px">Instagram: <a href="https://instagram.com/" target="_blank" rel="noopener">instagram.com/<span class="muted">[handle]</span></a></p>
            <p style="margin:0">TikTok: <a href="https://tiktok.com/@" target="_blank" rel="noopener">tiktok.com/@<span class="muted">[handle]</span></a></p>
          </div>
          <div><p class="muted" style="margin:0" data-i18n="contacts.press">Press / deck — on request.</p></div>
        </div>
      </section>
    </main>

    <footer>
      <div>© <span id="y"></span> frame.899</div>
      <div class="social">
        <a href="#projects" data-i18n="nav.projects">Projects</a>
        <a href="#collabs" data-i18n="nav.collabs">Collabs</a>
        <a href="#about" data-i18n="nav.about">About</a>
        <a href="#contacts" data-i18n="nav.contacts">Contacts</a>
      </div>
    </footer>
  </div>

  <!-- MODAL -->
  <div id="overlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="m-title">
      <button class="m-close" aria-label="Close">
        <svg class="icon" viewBox="0 0 24 24"><path d="M6 6l12 12M18 6L6 18"/></svg>
      </button>

      <div class="m-media">
        <div class="mnav">
          <button class="iconbtn prev" aria-label="Previous">
            <svg class="icon" viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
          </button>
          <button class="iconbtn next" aria-label="Next">
            <svg class="icon" viewBox="0 0 24 24"><path d="M9 6l6 6-6 6"/></svg>
          </button>
        </div>
        <div class="viewport"></div>
        <button class="fs-btn" id="fsBtn" title="Fullscreen">
          <svg class="icon" viewBox="0 0 24 24"><path d="M9 3H3v6M15 3h6v6M9 21H3v-6M21 21h-6v-6"/></svg>
        </button>
      </div>

      <div class="m-meta">
        <h3 id="m-title"></h3>
        <p class="m-sub"></p>
        <div class="m-desc"></div>
        <div class="m-stmt"></div>
      </div>

      <div class="m-thumbs" id="thumbs"></div>
      <div class="m-dots" id="mdots"></div>
    </div>
  </div>

<script>
/* ===== i18n ===== */
const I18N = {
  en: {
    "kicker":"media & light systems",
    "h1":"Projects at the edge of art, tech and light",
    "lead":"Visual first; details and team below. Built for pitching, submissions and exhibitions.",
    "nav.projects":"Projects","nav.collabs":"Collabs","nav.about":"About","nav.contacts":"Contacts",
    "projects.title":"Projects","collabs.title":"Collabs","about.title":"About",
    "about.kristina":"Production director & media artist (Cyprus). Experience: FIFA World Cup (Closing), AFC Asian Cup (Opening), The Weeknd tour, Robert Wun, Phillip Lim, Milan Design Week. Blends artistic vision with production rigor: visual systems, site adaptation, show planning.",
    "about.ivan":"CG artist & architect. Spatial visualization, scene readability, integration of media in architecture. Focus on interactivity and light installations.",
    "about.note":"Some listed large-scale works were done as part of previous teams; media not published due to IP rights.",
    "contacts.title":"Contacts","contacts.loc":"Base: Cyprus, Limassol","contacts.press":"Press / deck — on request."
  },
  ru: {
    "kicker":"media & light systems",
    "h1":"Проекты на стыке искусства, технологий и света",
    "lead":"Сначала — визуал; ниже детали и команда. Формат для питчей, заявок и выставок.",
    "nav.projects":"Проекты","nav.collabs":"Коллаборации","nav.about":"О нас","nav.contacts":"Контакты",
    "projects.title":"Проекты","collabs.title":"Коллаборации","about.title":"О нас",
    "about.kristina":"Продакшен-директор и медиа-художник (Кипр). Опыт: FIFA World Cup (Closing), AFC Asian Cup (Opening), The Weeknd tour, Robert Wun, Phillip Lim, Milan Design Week. Соединяет художественное видение и продакшен-точность: визуальные системы, адаптация под площадку, планы шоу.",
    "about.ivan":"CG-артист и архитектор. Пространственная визуализация, читаемость сцены, интеграция медиа в архитектуру. Фокус — интерактив и световые инсталляции.",
    "about.note":"Часть крупных проектов выполнена в составе предыдущих команд; медиа не публикуются из-за прав ИС.",
    "contacts.title":"Контакты","contacts.loc":"База: Кипр, Лимассол","contacts.press":"Пресс/дека — по запросу."
  }
};
let LANG = (new URL(location.href).searchParams.get('lang')) || localStorage.getItem('lang') || 'en';
function applyI18n(){
  document.documentElement.lang = LANG;
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const k = el.getAttribute('data-i18n');
    if(I18N[LANG][k]) el.textContent = I18N[LANG][k];
  });
  enBtn.classList.toggle('is-active', LANG==='en');
  ruBtn.classList.toggle('is-active', LANG==='ru');
}
const enBtn=document.getElementById('enBtn');
const ruBtn=document.getElementById('ruBtn');
enBtn.onclick = ()=>{ LANG='en'; localStorage.setItem('lang','en'); applyI18n(); rebuildText(); };
ruBtn.onclick = ()=>{ LANG='ru'; localStorage.setItem('lang','ru'); applyI18n(); rebuildText(); };

/* ===== Date ===== */
document.getElementById('y').textContent = new Date().getFullYear();

/* ===== Data ===== */
const PROJECTS = {
  mycy:  { title:{en:"My Cyprus Walk", ru:"My Cyprus Walk"},
           sub:{en:"2025 · Cyprus · iPad/WebGL", ru:"2025 · Кипр · iPad/WebGL"},
           desc:{en:"Interactive digital walk through memory and adaptation.", ru:"Интерактивная «цифровая прогулка» о памяти и адаптации."},
           stmt:{en:"Memory keeps fragments; we translate them into a digital simulation.", ru:"Память хранит обрывки; мы переводим их в цифровую симуляцию."},
           folder:"mycy",  count:9,  video:null, isCollab:false, ext:'png' },
  flora: { title:{en:"Cyprus Flora Series. 00 Anemóne coronária", ru:"Cyprus Flora Series. 00 Anemóne coronária"},
           sub:{en:"2025 · Cyprus · video series", ru:"2025 · Кипр · видео-серия"},
           desc:{en:"A series about endemic flora; this chapter focuses on Anemóne coronária.", ru:"Серия об эндемиках Кипра; этот выпуск — Anemóne coronária."},
           stmt:{en:"Nature as a subject that returns the gaze.", ru:"Природа как субъект, возвращающий взгляд."},
           folder:"anem",  count:9,  video:null, isCollab:false, ext:'png' },
  water: { title:{en:"Water Spirits — White Rocks", ru:"Water Spirits — White Rocks"},
           sub:{en:"2025 · Limassol · outdoor projection", ru:"2025 · Лимассол · аутдор-проекция"},
           desc:{en:"Projection on limestone near the sea; a 5-min sketch.", ru:"Проекция на известняке у моря; 5-минутный эскиз."},
           stmt:{en:"Sea as a spirit: comforting and unsettling.", ru:"Море как дух: утешает и тревожит."},
           folder:"waspi", count:4,  video:"assets/images/waspiedit.mp4", isCollab:false, ext:'png' },
  trace: { title:{en:"Trace × Kolla", ru:"Trace × Kolla"},
           sub:{en:"2025 · Limassol · collaboration", ru:"2025 · Лимассол · коллаборация"},
           desc:{en:"Participatory installation about shared memory.", ru:"Партисипаторная инсталляция о совместной памяти."},
           stmt:{en:"A living archive built by visitors.", ru:"Живой архив, собираемый зрителями."},
           folder:"trace", count:9,  video:null, isCollab:true, ext:'png' },
  tri:   { title:{en:"Trinitron Connect (with Anya Krow)", ru:"Trinitron Connect (с Аней Кроу)"},
           sub:{en:"2025 · Moscow · gallery installation", ru:"2025 · Москва · галерейная инсталляция"},
           desc:{en:"Digital avatar reacts to gestures and phones.", ru:"Цифровой аватар реагирует на жесты и телефоны."},
           stmt:{en:"Meeting a digital double.", ru:"Встреча с цифровым двойником."},
           folder:"tri",   count:7,  video:null, isCollab:true, ext:'png' }
};

/* ===== Build media & covers (без сетевых проверок, с fallback) ===== */
function buildMedia(){
  for(const id in PROJECTS){
    const p = PROJECTS[id];
    const ext = p.ext || 'png';
    p.media = [];
    for(let i=0;i<p.count;i++){
      const n = String(i).padStart(2,'0');
      p.media.push({ type:'img', src:`assets/images/${p.folder}${n}.${ext}` });
    }
    if(p.video){ p.media.splice(1,0,{type:'video',src:p.video}); }
    p.heroCover = `assets/images/${p.folder}00image.${ext}`;
    p.cardCover = `assets/images/${p.folder}00image2.${ext}`;
  }
}

/* ===== HERO ===== */
function buildHero(){
  const slidesEl = document.getElementById('slides');
  const hdots = document.getElementById('hdots');
  const order = ['mycy','flora','water','trace','tri']; // include collabs
  slidesEl.innerHTML = ''; hdots.innerHTML = '';

  order.forEach((id, idx)=>{
    const p = PROJECTS[id];
    const art = document.createElement('article');
    art.className='slide'; art.setAttribute('data-project', id);

    const img = document.createElement('img');
    img.src = p.heroCover || (p.media[0]?.src||'');
    img.onerror = ()=>{ img.onerror=null; img.src = p.media[0]?.src || ''; };
    art.appendChild(img);

    const meta = document.createElement('div'); meta.className='meta';
    meta.innerHTML = `<h3>${p.title[LANG]}</h3><p class="muted">${p.sub[LANG]}</p>`;
    art.appendChild(meta);
    slidesEl.appendChild(art);

    const dot=document.createElement('button'); if(idx===0) dot.classList.add('active'); hdots.appendChild(dot);
    dot.addEventListener('click',()=>goTo(idx));
  });

  // looped index
  let idx = 0;
  function update(){
    slidesEl.style.transition = 'transform .35s ease';
    slidesEl.style.transform = `translateX(${-idx*100}%)`;
    [...hdots.children].forEach((d,i)=>d.classList.toggle('active',i===idx));
  }
  function goTo(i){ const N=slidesEl.children.length; idx=((i%N)+N)%N; update(); }
  function prev(){ goTo(idx-1); }
  function next(){ goTo(idx+1); }

  // desktop: только стрелки/точки
  document.getElementById('hPrev').onclick=prev;
  document.getElementById('hNext').onclick=next;

  // mobile: свайп
  const isTouch = matchMedia('(pointer: coarse)').matches;
  if(isTouch){
    let startX=0, curX=0, dragging=false;
    slidesEl.addEventListener('touchstart',e=>{ dragging=true; startX=e.touches[0].clientX; curX=startX; slidesEl.style.transition='none'; },{passive:true});
    slidesEl.addEventListener('touchmove',e=>{ if(!dragging) return; curX=e.touches[0].clientX; const dx=(curX-startX)/slidesEl.clientWidth*100; slidesEl.style.transform=`translateX(${(-idx*100)+dx}%)`; },{passive:true});
    slidesEl.addEventListener('touchend',()=>{ if(!dragging) return; const dx=curX-startX; dragging=false; if(Math.abs(dx)>40) (dx<0?next():prev()); else update(); },{passive:true});
  }

  slidesEl.querySelectorAll('.slide').forEach(el=>{
    el.addEventListener('click',()=>openModal(el.getAttribute('data-project')));
  });

  update();
}

/* ===== GRID ===== */
function buildGrids(){
  const projEl = document.getElementById('grid-projects');
  const collEl = document.getElementById('grid-collabs');
  projEl.innerHTML=''; collEl.innerHTML='';
  for(const id in PROJECTS){
    const p = PROJECTS[id];
    const card = document.createElement('article'); card.className='card'; card.setAttribute('data-project',id);
    const thumb = document.createElement('div'); thumb.className='thumb';
    const img = document.createElement('img');
    img.src = p.cardCover || (p.media[0]?.src || '');
    img.onerror = ()=>{ img.onerror=null; img.src = p.media[0]?.src || ''; };
    thumb.appendChild(img);
    const meta = document.createElement('div'); meta.className='meta2';
    meta.innerHTML = `<div class="tag">${p.isCollab?'collab':'project'}</div>
      <h3 style="margin:8px 0 6px">${p.title[LANG]}</h3>
      <p class="muted" style="margin:0">${p.sub[LANG]}</p>`;
    card.appendChild(thumb); card.appendChild(meta);
    (p.isCollab?collEl:projEl).appendChild(card);
  }
  document.querySelectorAll('[data-project]').forEach(el=>{
    el.style.cursor='pointer';
    el.addEventListener('click',(ev)=>{ if(ev.target.closest('a')) return; openModal(el.getAttribute('data-project')); });
  });
}

/* ===== MODAL ===== */
const overlay = document.getElementById('overlay');
const mTitle  = overlay.querySelector('#m-title');
const mSub    = overlay.querySelector('.m-sub');
const mDesc   = overlay.querySelector('.m-desc');
const mStmt   = overlay.querySelector('.m-stmt');
const viewport= overlay.querySelector('.viewport');
const thumbs  = document.getElementById('thumbs');
const mdots   = overlay.querySelector('#mdots');
const btnPrev = overlay.querySelector('.prev');
const btnNext = overlay.querySelector('.next');
const btnClose= overlay.querySelector('.m-close');
const fsBtn   = document.getElementById('fsBtn');

let current=null, index=0;

function renderDots(){
  mdots.innerHTML=''; if(!current) return;
  current.media.forEach((_,i)=>{ const b=document.createElement('button'); if(i===index) b.classList.add('active'); b.onclick=()=>{ index=i; renderMedia(); }; mdots.appendChild(b); });
}
function renderThumbs(){
  thumbs.innerHTML=''; if(!current) return;
  current.media.forEach((m,i)=>{
    const b=document.createElement('button');
    if(m.type==='img'){
      const t=document.createElement('img'); t.src=m.src; b.appendChild(t);
      t.onerror=()=>{ b.style.visibility='hidden'; };
    }else{
      b.classList.add('vid');
    }
    b.addEventListener('click', ()=>{ index=i; renderMedia(); });
    if(i===index) b.classList.add('is-active');
    thumbs.appendChild(b);
  });
}
function renderMedia(){
  viewport.innerHTML=''; if(!current) return;
  const item=current.media[index]; if(!item) return;
  if(item.type==='img'){ const img=document.createElement('img'); img.src=item.src; img.alt=current.title?.[LANG]||''; viewport.appendChild(img); }
  else { const v=document.createElement('video'); v.src=item.src; v.controls=true; v.playsInline=true; viewport.appendChild(v); }
  // sync
  [...thumbs.children].forEach((b,i)=>b.classList.toggle('is-active', i===index));
  [...mdots.children].forEach((d,i)=>d.classList.toggle('active', i===index));
}
function openModal(projectId){
  const data = PROJECTS[projectId]; if(!data) return;
  current=data; index=0;
  mTitle.textContent=data.title[LANG]; mSub.textContent=data.sub[LANG];
  mDesc.textContent=data.desc[LANG]; mStmt.textContent=data.stmt[LANG];
  renderThumbs(); renderDots(); renderMedia();
  overlay.classList.add('show'); overlay.setAttribute('aria-hidden','false');
}
function closeModal(){ overlay.classList.remove('show'); overlay.setAttribute('aria-hidden','true'); viewport.innerHTML=''; current=null; thumbs.innerHTML=''; mdots.innerHTML=''; }

btnPrev.addEventListener('click', ()=>{ if(!current) return; index=(index-1+current.media.length)%current.media.length; renderMedia(); });
btnNext.addEventListener('click', ()=>{ if(!current) return; index=(index+1)%current.media.length; renderMedia(); });
btnClose.addEventListener('click', closeModal);
document.addEventListener('keydown', (e)=>{ if(!overlay.classList.contains('show')) return; if(e.key==='Escape') closeModal(); if(e.key==='ArrowRight') btnNext.click(); if(e.key==='ArrowLeft') btnPrev.click(); });

/* Mobile-only swipe inside modal */
const isTouch = matchMedia('(pointer: coarse)').matches;
if(isTouch){
  let sx=0, cx=0, drag=false;
  viewport.addEventListener('touchstart', e=>{ drag=true; sx=e.touches[0].clientX; cx=sx; }, {passive:true});
  viewport.addEventListener('touchmove',  e=>{ if(!drag) return; cx=e.touches[0].clientX; }, {passive:true});
  viewport.addEventListener('touchend',   ()=>{ if(!drag) return; const dx=cx-sx; drag=false; if(Math.abs(dx)>40){ (dx<0?btnNext:btnPrev).click(); } }, {passive:true});
}

/* fullscreen ⛶ — на блоке m-media */
fsBtn.addEventListener('click', ()=>{
  const el = document.querySelector('.m-media');
  if (!document.fullscreenElement){ el.requestFullscreen?.(); }
  else{ document.exitFullscreen?.(); }
});

/* ===== Text rebuild on lang change ===== */
function rebuildText(){
  // hero titles meta
  document.querySelectorAll('#slides .slide').forEach(sl=>{
    const id=sl.getAttribute('data-project'); const p=PROJECTS[id];
    sl.querySelector('.meta').innerHTML=`<h3>${p.title[LANG]}</h3><p class="muted">${p.sub[LANG]}</p>`;
  });
  // grid
  buildGrids();
}

/* ===== INIT ===== */
function init(){
  applyI18n();
  buildMedia();
  buildGrids();
  buildHero();
  const url = new URL(location.href); const pid = url.searchParams.get('p'); if(pid && PROJECTS[pid]) openModal(pid);
}
init();
</script>
</body>
</html>
